var je=Object.create;var F=Object.defineProperty;var he=Object.getOwnPropertyDescriptor;var ve=Object.getOwnPropertyNames;var ye=Object.getPrototypeOf,be=Object.prototype.hasOwnProperty;var X=e=>F(e,"__esModule",{value:!0});var we=(e,t)=>{X(e);for(var r in t)F(e,r,{get:t[r],enumerable:!0})},ke=(e,t,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of ve(t))!be.call(e,o)&&o!=="default"&&F(e,o,{get:()=>t[o],enumerable:!(r=he(t,o))||r.enumerable});return e},b=e=>ke(X(F(e!=null?je(ye(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);we(exports,{activate:()=>it,buildDiagnosticCollection:()=>A,deactivate:()=>ft,logChannel:()=>E,zigFormatStatusBar:()=>at});var y=b(require("vscode"));var de=b(require("path")),K=b(require("child_process")),u=b(require("vscode"));var Ce=typeof global=="object"&&global&&global.Object===Object&&global,Q=Ce;var Se=typeof self=="object"&&self&&self.Object===Object&&self,Ie=Q||Se||Function("return this")(),L=Ie;var Oe=L.Symbol,W=Oe;var Y=Object.prototype,Ee=Y.hasOwnProperty,Te=Y.toString,R=W?W.toStringTag:void 0;function De(e){var t=Ee.call(e,R),r=e[R];try{e[R]=void 0;var o=!0}catch(l){}var s=Te.call(e);return o&&(t?e[R]=r:delete e[R]),s}var ee=De;var We=Object.prototype,Ae=We.toString;function Be(e){return Ae.call(e)}var te=Be;var Re="[object Null]",ze="[object Undefined]",re=W?W.toStringTag:void 0;function Pe(e){return e==null?e===void 0?ze:Re:re&&re in Object(e)?ee(e):te(e)}var oe=Pe;function Fe(e){return e!=null&&typeof e=="object"}var se=Fe;var Le="[object Symbol]";function Ne(e){return typeof e=="symbol"||se(e)&&oe(e)==Le}var ae=Ne;var _e=/\s/;function Me(e){for(var t=e.length;t--&&_e.test(e.charAt(t)););return t}var ie=Me;var qe=/^\s+/;function Ue(e){return e&&e.slice(0,ie(e)+1).replace(qe,"")}var fe=Ue;function Ge(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var O=Ge;var ne=0/0,Ke=/^[-+]0x[0-9a-f]+$/i,$e=/^0b[01]+$/i,Ve=/^0o[0-7]+$/i,Ze=parseInt;function Je(e){if(typeof e=="number")return e;if(ae(e))return ne;if(O(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=O(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=fe(e);var r=$e.test(e);return r||Ve.test(e)?Ze(e.slice(2),r?2:8):Ke.test(e)?ne:+e}var G=Je;var He=function(){return L.Date.now()},N=He;var Xe="Expected a function",Qe=Math.max,Ye=Math.min;function et(e,t,r){var o,s,l,a,f,i,c=0,n=!1,p=!1,d=!0;if(typeof e!="function")throw new TypeError(Xe);t=G(t)||0,O(r)&&(n=!!r.leading,p="maxWait"in r,l=p?Qe(G(r.maxWait)||0,t):l,d="trailing"in r?!!r.trailing:d);function j(m){var S=o,B=s;return o=s=void 0,c=m,a=e.apply(B,S),a}function x(m){return c=m,f=setTimeout(g,t),n?j(m):a}function h(m){var S=m-i,B=m-c,H=t-S;return p?Ye(H,l-B):H}function w(m){var S=m-i,B=m-c;return i===void 0||S>=t||S<0||p&&B>=l}function g(){var m=N();if(w(m))return C(m);f=setTimeout(g,h(m))}function C(m){return f=void 0,d&&o?j(m):(o=s=void 0,a)}function I(){f!==void 0&&clearTimeout(f),c=0,o=i=s=f=void 0}function k(){return f===void 0?a:C(N())}function D(){var m=N(),S=w(m);if(o=arguments,s=this,i=m,S){if(f===void 0)return x(i);if(p)return clearTimeout(f),f=setTimeout(g,t),j(i)}return f===void 0&&(f=setTimeout(g,t)),a}return D.cancel=I,D.flush=k,D}var le=et;var tt="Expected a function";function rt(e,t,r){var o=!0,s=!0;if(typeof e!="function")throw new TypeError(tt);return O(r)&&(o="leading"in r?!!r.leading:o,s="trailing"in r?!!r.trailing:s),le(e,t,{leading:o,maxWait:t,trailing:s})}var _=rt;"use strict";var M=class{buildDiagnostics;astDiagnostics;dirtyChange=new WeakMap;activate(t){t.push(this),this.buildDiagnostics=u.languages.createDiagnosticCollection("zig"),this.astDiagnostics=u.languages.createDiagnosticCollection("zig"),u.workspace.onDidChangeTextDocument(this.maybeDoASTGenErrorCheck,this)}maybeDoASTGenErrorCheck(t){t.document.languageId==="zig"&&(t.document.isClosed&&this.astDiagnostics.delete(t.document.uri),this.doASTGenErrorCheck(t),t.document.isUntitled||(u.workspace.getConfiguration("zig").get("buildOnSave")&&this.dirtyChange.has(t.document.uri)&&this.dirtyChange.get(t.document.uri)!==t.document.isDirty&&!t.document.isDirty&&this.doCompile(t.document),this.dirtyChange.set(t.document.uri,t.document.isDirty)))}dispose(){this.buildDiagnostics.clear(),this.astDiagnostics.clear(),this.buildDiagnostics.dispose(),this.astDiagnostics.dispose()}_doASTGenErrorCheck(t){let r=u.workspace.getConfiguration("zig"),o=t.document;if(o.languageId!=="zig")return;let s=r.get("zigPath")||"zig",l=u.workspace.getWorkspaceFolder(o.uri).uri.fsPath,a=K.spawn(s,["ast-check"],{cwd:l});if(!!a.pid){var f="";a.stderr.on("data",i=>{f+=i}),a.stdin.end(t.document.getText(null)),a.once("close",()=>{if(this.doASTGenErrorCheck.cancel(),this.astDiagnostics.delete(o.uri),f.length==0)return;var i={};let c=/(\S.*):(\d*):(\d*): ([^:]*): (.*)/g;for(let n=c.exec(f);n;n=c.exec(f)){let p=o.uri.fsPath,d=parseInt(n[2])-1,j=parseInt(n[3])-1,x=n[4],h=n[5],w=x.trim().toLowerCase()==="error"?u.DiagnosticSeverity.Error:u.DiagnosticSeverity.Information,g=new u.Range(d,j,d,1/0);i[p]==null&&(i[p]=[]),i[p].push(new u.Diagnostic(g,h,w))}for(let n in i){let p=i[n];this.astDiagnostics.set(o.uri,p)}})}}_doCompile(t){let r=u.workspace.getConfiguration("zig"),o=r.get("buildOption"),s=[o],l=u.workspace.getWorkspaceFolder(t.uri);!l&&u.workspace.workspaceFolders.length&&(l=u.workspace.workspaceFolders[0]);let a=l.uri.fsPath;switch(o){case"build":let n=r.get("buildFilePath");s.push("--build-file");try{s.push(de.resolve(n.replace("${workspaceFolder}",a)))}catch{}break;default:s.push(t.fileName);break}r.get("buildArgs").forEach(n=>{s.push(n)});let i="",c=K.spawn("zig",s,{cwd:a});c.pid&&(c.stderr.on("data",n=>{i+=n}),c.stdout.on("end",()=>{this.doCompile.cancel();var n={};let p=/(\S.*):(\d*):(\d*): ([^:]*): (.*)/g;this.buildDiagnostics.clear();for(let d=p.exec(i);d;d=p.exec(i)){let j=d[1].trim();try{j.includes(a)||(j=require("path").resolve(l.uri.fsPath,j))}catch{}let x=parseInt(d[2])-1,h=parseInt(d[3])-1,w=d[4],g=d[5];if(this.astDiagnostics.has(t.uri))for(let k of this.astDiagnostics.get(t.uri))!(k.range.start.line===x&&k.range.start.character===h);let C=w.trim().toLowerCase()==="error"?u.DiagnosticSeverity.Error:u.DiagnosticSeverity.Information,I=new u.Range(x,h,x,1/0);n[j]==null&&(n[j]=[]),n[j].push(new u.Diagnostic(I,g,C))}for(let d in n){let j=n[d];this.buildDiagnostics.set(u.Uri.file(d),j)}}))}doASTGenErrorCheck=_(this._doASTGenErrorCheck,16,{trailing:!0});doCompile=_(this._doCompile,60);provideCodeActions(t,r,o,s){return[]}};var ue=b(require("child_process")),v=b(require("vscode"));function pe(){let e=v.window.activeTextEditor,t=e.document;if(t.languageId!=="zig")return;let r=v.workspace.getConfiguration("zig"),o=r.get("buildOption"),s=[o];switch(o){case"build":break;default:s.push(t.fileName);break}r.get("buildArgs").forEach(c=>{s.push(c)});let a=v.workspace.getWorkspaceFolder(e.document.uri).uri.fsPath,f=r.get("zigPath")||"zig";E.appendLine(`Starting building the current workspace at ${a}`);let i=ue.execFile(f,s,{cwd:a},(c,n,p)=>{E.appendLine(p);var d={};let j=/(\S.*):(\d*):(\d*): ([^:]*): (.*)/g;A.clear();for(let x=j.exec(p);x;x=j.exec(p)){let h=x[1].trim();try{h.includes(a)||(h=require("path").resolve(a,h))}catch{}let w=parseInt(x[2])-1,g=parseInt(x[3])-1,C=x[4],I=x[5],k=C.trim().toLowerCase()==="error"?v.DiagnosticSeverity.Error:v.DiagnosticSeverity.Information,D=new v.Range(w,g,w,1/0);d[h]==null&&(d[h]=[]),d[h].push(new v.Diagnostic(D,I,k))}for(let x in d){let h=d[x];A.set(v.Uri.file(x),h)}})}var T=b(require("vscode")),V=b(require("vscode"));var q=b(require("child_process")),U=b(require("fs")),z=b(require("path")),P=b(require("vscode")),$=process.platform==="win32";function me(e,t={}){let{fileName:r,onStart:o,onStdout:s,onStderr:l,onExit:a,cmdArguments:f}=t,i,c=!0,n=!1,p=new Promise((j,x)=>{let h=t?t.cmdArguments:[];i=q.exec(e+" "+(h||[]).join(" "),{cwd:st(r||P.workspace.rootPath+"/fakeFileName"),maxBuffer:10*1024*1024},w),i.stdout.on("data",g=>{c&&o&&o(),c=!1,s&&s(g.toString())}),i.stderr.on("data",g=>{c&&o&&o(),c=!1,l&&l(g.toString())});function w(g,C,I){if(p.isRunning=!1,a&&a(),!n)if(g)if(t.showMessageOnError){let k=e.split(" ",1)[0];if($&&g.message.includes(`'${k}' is not recognized`)||!$&&g.code===127){let m=t?t.notFoundText:"";P.window.showErrorMessage(`${k} is not available in your path. `+m)}else P.window.showErrorMessage(g.message)}else x(g);else j({stdout:C,stderr:I})}});return p.stdin=i.stdin,p.kill=d,p.isRunning=!0,p;function d(){n=!0,$?q.spawn("taskkill",["/pid",i.pid.toString(),"/f","/t"]):i.kill("SIGINT")}}var ot="build.zig";function ce(e,t){if(e===""||e===t)return"";if(U.lstatSync(e).isDirectory()){let r=z.join(e,ot);if(U.existsSync(r))return e}return ce(z.dirname(e),e)}function st(e){let t=ce(z.dirname(e),"");if(t!=="")return t}var Z=class{_channel;constructor(t){this._channel=t}provideDocumentFormattingEdits(t,r,o){let s=this._channel;return xe(t).then(({stdout:l})=>{s.clear();let a=t.lineCount-1,f=new T.Range(0,0,a,t.lineAt(a).text.length);return[new V.TextEdit(f,l)]}).catch(l=>{let a=T.workspace.getConfiguration("zig");return s.clear(),s.appendLine(l.toString().replace("<stdin>",t.fileName)),a.get("revealOutputChannelOnFormattingError")&&s.show(!0),null})}},J=class{_channel;constructor(t){this._channel=t}provideDocumentRangeFormattingEdits(t,r,o,s){let l=this._channel;return xe(t).then(({stdout:a})=>{l.clear();let f=t.lineCount-1,i=new T.Range(0,0,f,t.lineAt(f).text.length);return[new V.TextEdit(i,a)]}).catch(a=>{let f=T.workspace.getConfiguration("zig");return l.clear(),l.appendLine(a.toString().replace("<stdin>",t.fileName)),f.get("revealOutputChannelOnFormattingError")&&l.show(!0),null})}};function xe(e){let r=T.workspace.getConfiguration("zig").get("zigPath")||"zig",s=me(r,{cmdArguments:["fmt","--stdin"],notFoundText:"Could not find zig. Please add zig to your PATH or specify a custom path to the zig binary in your settings."});return s.stdin.write(e.getText()),s.stdin.end(),s}"use strict";var ge={language:"zig",scheme:"file"},A,E=y.window.createOutputChannel("zig"),at=y.window.createStatusBarItem(y.StatusBarAlignment.Left);function it(e){let t=new M;t.activate(e.subscriptions),y.languages.registerCodeActionsProvider("zig",t),e.subscriptions.push(E),e.subscriptions.push(y.languages.registerDocumentFormattingEditProvider(ge,new Z(E))),e.subscriptions.push(y.languages.registerDocumentRangeFormattingEditProvider(ge,new J(E))),A=y.languages.createDiagnosticCollection("zig"),e.subscriptions.push(A),e.subscriptions.push(y.commands.registerCommand("zig.build.workspace",()=>pe())),e.subscriptions.push(y.commands.registerCommand("zig.format.file",()=>console.log("test")))}function ft(){}0&&(module.exports={activate,buildDiagnosticCollection,deactivate,logChannel,zigFormatStatusBar});
/**
 * @license
 * Lodash (Custom Build) <https://lodash.com/>
 * Build: `lodash modularize exports="es" -o ./`
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
